# render.yaml
# This file tells Render how to deploy your multi-service application.

services:
  # 1. The Backend API Service (Node.js / Express)
  - name: axion-flow-backend
    type: web
    runtime: docker
    plan: free
    dockerfilePath: ./backend-api/Dockerfile
    rootDir: backend-api
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: axion-flow-db
          property: connectionString
      - key: AI_SERVICE_URL
        # This uses the internal service name for private network communication.
        value: http://axion-flow-ai-service:8000
      - fromGroup: axion-flow-secrets

  # 2. The AI Service (Python / FastAPI)
  - name: axion-flow-ai-service
    type: web
    runtime: docker
    plan: free
    dockerfilePath: ./ai-service/Dockerfile
    rootDir: ai-service

  # 3. The Frontend Service (React / Vite)
  # NOTE: If you are using Vercel for the frontend, delete this entire service block.
  - name: axion-flow-frontend
    type: web
    runtime: docker
    plan: free
    dockerfilePath: ./frontend-dashboard/Dockerfile
    rootDir: frontend-dashboard
    envVars:
      # --- THIS IS THE CORRECTED PART ---
      # We provide the final public URL of the backend service directly.
      # This value is injected into the Vite build process.
      - key: VITE_API_URL
        value: https://axion-flow-backend.onrender.com/api

# Defines the PostgreSQL databases to be deployed
databases:
  - name: axion-flow-db
    plan: free

# Defines groups of secret environment variables
envVarGroups:
  - name: axion-flow-secrets
    envVars:
      - key: JWT_SECRET
        sync: false
      - key: SCREENSHOTONE_API_KEY
        sync: false
      - key: SENDGRID_API_KEY
        sync: false