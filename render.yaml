# This file tells Render how to deploy your multi-service application,
# written according to the official Blueprint YAML Reference.

# Defines the services to be deployed (web servers, workers, etc.)
services:
  # 1. The Backend API Service (Node.js / Express)
  - name: axion-flow-backend
    type: web # It's a web service accessible from the internet
    runtime: docker # We are building it from a Dockerfile
    plan: free # Use the free instance type
    dockerfilePath: ./backend-api/Dockerfile
    # The root directory for this service, so changes in other folders don't trigger a rebuild
    rootDir: backend-api
    # Define the environment variables the backend needs
    envVars:
      - key: DATABASE_URL
        # This special value tells Render to use the connection string
        # from the database service defined in the 'databases' block below.
        fromDatabase:
          name: axion-flow-db
          property: connectionString
      # This tells the backend how to find the AI service on Render's private network
      - key: AI_SERVICE_URL
        fromService:
          name: axion-flow-ai-service
          type: web # The type of service we are referencing
          property: hostport # 'hostport' gives us the internal URL like 'axion-flow-ai-service:8000'
      # Pulls secrets from a "Secret File" you will create in the Render UI
      - fromGroup: axion-flow-secrets

  # 2. The AI Service (Python / FastAPI)
  - name: axion-flow-ai-service
    type: web
    runtime: docker
    plan: free
    dockerfilePath: ./ai-service/Dockerfile
    rootDir: ai-service

  # 3. The Frontend Service (React / Vite)
  # NOTE: If you decide to use Vercel for the frontend, you should DELETE this entire service block.
  - name: axion-flow-frontend
    type: web
    runtime: docker
    plan: free
    dockerfilePath: ./frontend-dashboard/Dockerfile
    rootDir: frontend-dashboard
    envVars:
      # This tells the Vite app the PUBLIC URL of the backend service during the build process
      - key: VITE_API_URL
        fromService:
          type: web
          name: axion-flow-backend
          property: url # 'url' gives the public https://... URL

# Defines the PostgreSQL databases to be deployed
databases:
  # 1. The PostgreSQL Database
  - name: axion-flow-db
    plan: free # Use the free tier for the database
    # Render will automatically provision and manage this database.

# Defines groups of secret environment variables
# You will create this group in the Render Dashboard UI
envVarGroups:
  - name: axion-flow-secrets
    envVars:
      # Use 'sync: false' to have Render prompt you for these secrets on first deploy,
      # which is the most secure method.
      - key: JWT_SECRET
        sync: false
      - key: SCREENSHOTONE_API_KEY
        sync: false
      - key: SENDGRID_API_KEY
        sync: false